---
title: 'Registrar Leitura'
openapi: 'POST /streaks/read'
---

## Descrição

Registra uma nova leitura de conteúdo para um usuário, atualizando seu streak.

O post pode ser identificado pelo `postId` ou pela `postUrl`. Se nenhum dos dois for fornecido, o endpoint apenas recalcula o streak do usuário sem registrar uma nova leitura.

## Autenticação

<Note>
  **Requer autenticação.** O email do leitor é obtido automaticamente do token JWT. Não é necessário enviar o email no body da requisição.
</Note>

<ParamField header="Authorization" type="string" required>
  Token JWT no formato `Bearer <token>`
</ParamField>

## Request Body

<ParamField body="postId" type="string">
  ID do post lido. Opcional se `postUrl` for fornecido.
</ParamField>

<ParamField body="postUrl" type="string">
  URL do post lido. Alternativa ao `postId` - o sistema buscará o post correspondente pela URL no banco de dados. Opcional se `postId` for fornecido.
</ParamField>

<ParamField body="utm_source" type="string">
  Fonte UTM para tracking
</ParamField>

<ParamField body="utm_medium" type="string">
  Meio UTM para tracking
</ParamField>

<ParamField body="utm_campaign" type="string">
  Campanha UTM para tracking
</ParamField>

<Note>
  **Identificação do Post:** Forneça `postId` OU `postUrl`. Se ambos forem fornecidos, o `postId` terá prioridade. Se nenhum for fornecido, o endpoint apenas recalculará o streak do usuário.
</Note>

## Response

<ResponseField name="success" type="boolean">
  Indica se a operação foi bem-sucedida
</ResponseField>

<ResponseField name="message" type="string">
  Mensagem informativa sobre o resultado
</ResponseField>

<ResponseField name="data" type="object">
  <Expandable title="properties">
    <ResponseField name="readerId" type="string">
      ID único do leitor
    </ResponseField>

    <ResponseField name="currentStreak" type="number">
      Streak atual do usuário
    </ResponseField>

    <ResponseField name="maxStreak" type="number">
      Maior streak já alcançado pelo usuário
    </ResponseField>

    <ResponseField name="readToday" type="boolean">
      Indica se o usuário já leu hoje
    </ResponseField>
  </Expandable>
</ResponseField>

## Exemplos de Uso

### Registrar leitura com postId

<RequestExample>

```bash Usando postId
curl --request POST \
  --url https://backend.testeswaffle.org/streaks/read \
  --header 'Authorization: Bearer <token>' \
  --header 'Content-Type: application/json' \
  --data '{
    "postId": "post_123456",
    "utm_source": "newsletter",
    "utm_medium": "email",
    "utm_campaign": "daily_news"
  }'
```

```bash Usando postUrl
curl --request POST \
  --url https://backend.testeswaffle.org/streaks/read \
  --header 'Authorization: Bearer <token>' \
  --header 'Content-Type: application/json' \
  --data '{
    "postUrl": "https://thenewscc.beehiiv.com/p/minha-newsletter",
    "utm_source": "newsletter",
    "utm_medium": "email",
    "utm_campaign": "daily_news"
  }'
```

```bash Recalcular streak (sem post)
curl --request POST \
  --url https://backend.testeswaffle.org/streaks/read \
  --header 'Authorization: Bearer <token>' \
  --header 'Content-Type: application/json' \
  --data '{}'
```

</RequestExample>

<ResponseExample>

```json Leitura registrada
{
  "success": true,
  "message": "Leitura registrada com sucesso",
  "data": {
    "readerId": "reader_789",
    "currentStreak": 7,
    "maxStreak": 15,
    "readToday": true
  }
}
```

```json Streak recalculado
{
  "success": true,
  "message": "Streak recalculado com sucesso.",
  "data": {
    "readerId": "reader_789",
    "currentStreak": 7,
    "maxStreak": 15,
    "readToday": true
  }
}
```

```json Post não encontrado (pela URL)
{
  "success": false,
  "message": "Post não encontrado para a URL informada."
}
```

</ResponseExample>
