---
title: "Chat with Tools"
api: "POST https://sac-waffle-v2.theo-110.workers.dev/openai/chat-with-tools"
description: "Chat com function calling para executar tools e a√ß√µes"
---

## Descri√ß√£o  

Chat completion com suporte a function calling (tools). Permite que o modelo chame fun√ß√µes espec√≠ficas para obter informa√ß√µes ou executar a√ß√µes durante a conversa.

## Headers

<ParamField header="Authorization" type="string" required>
  Bearer token JWT para autentica√ß√£o
</ParamField>

<ParamField header="Content-Type" type="string" required>
  `application/json`
</ParamField>

## Body Parameters

<ParamField body="prompt" type="string" required>
  Mensagem ou prompt para o modelo processar
</ParamField>

<ParamField body="systemPrompt" type="string">
  Instru√ß√µes do sistema para configurar o comportamento
</ParamField>

<ParamField body="model" type="string" default="gpt-4o-mini">
  Modelo GPT a ser usado
  
  **Recomendado para tools:**
  - `gpt-4o-mini` - Bom custo-benef√≠cio
  - `gpt-4o` - Melhor precis√£o em tools complexas
</ParamField>

<ParamField body="temperature" type="number" default="0.7">
  Controla a criatividade (0.0 a 2.0)
  
  **Para tools:** Recomenda-se 0.3 ou menor para precis√£o
</ParamField>

<ParamField body="tools" type="array">
  Lista de tools dispon√≠veis para uso
  
  **Tools internas dispon√≠veis:**
  - `get_current_date` - Obt√©m data/hora atual
  - `format_json` - Formata e valida JSON
  
  **Exemplo:**
  ```json
  ["get_current_date", "format_json"]
  ```
</ParamField>

<ParamField body="maxToolIterations" type="number" default="5">
  N√∫mero m√°ximo de itera√ß√µes de tools
  
  **Considera√ß√µes:**
  - Cada itera√ß√£o consome tokens adicionais
  - Evita loops infinitos
  - 5 √© suficiente para a maioria dos casos
</ParamField>

## Response

<ResponseField name="success" type="boolean" required>
  Indica se a opera√ß√£o foi bem-sucedida
</ResponseField>

<ResponseField name="data" type="object">
  <Expandable title="Dados da resposta">
    <ResponseField name="content" type="string">
      Resposta final gerada ap√≥s processar tools
    </ResponseField>
    
    <ResponseField name="toolResults" type="array">
      Resultados das tools executadas
      
      <Expandable title="Estrutura do resultado">
        <ResponseField name="toolName" type="string">
          Nome da tool executada
        </ResponseField>
        
        <ResponseField name="arguments" type="object">
          Argumentos passados para a tool
        </ResponseField>
        
        <ResponseField name="result" type="any">
          Resultado retornado pela tool
        </ResponseField>
        
        <ResponseField name="timestamp" type="number">
          Timestamp da execu√ß√£o
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="usage" type="object">
      <Expandable title="Estat√≠sticas de uso">
        <ResponseField name="promptTokens" type="number">
          Tokens usados no prompt
        </ResponseField>
        
        <ResponseField name="completionTokens" type="number">
          Tokens gerados
        </ResponseField>
        
        <ResponseField name="totalTokens" type="number">
          Total de tokens
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="finishReason" type="string">
      Motivo do t√©rmino
      
      **Valores:**
      - `stop` - Completou normalmente
      - `tool_calls` - Finalizou ap√≥s tools
      - `length` - Limite de tokens
    </ResponseField>
  </Expandable>
</ResponseField>

<RequestExample>

```bash Com Data Atual
curl -X POST https://sac-waffle-v2.theo-110.workers.dev/openai/chat-with-tools \
  -H "Authorization: Bearer seu_token_jwt" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Que dia √© hoje? E que dia da semana?",
    "tools": ["get_current_date"],
    "temperature": 0.3
  }'
```

```bash Formatar JSON
curl -X POST https://sac-waffle-v2.theo-110.workers.dev/openai/chat-with-tools \
  -H "Authorization: Bearer seu_token_jwt" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Formate este JSON: {\"name\":\"Jo√£o\",\"age\":30,\"city\":\"S√£o Paulo\"}",
    "tools": ["format_json"],
    "model": "gpt-4o-mini"
  }'
```

```bash M√∫ltiplas Tools
curl -X POST https://sac-waffle-v2.theo-110.workers.dev/openai/chat-with-tools \
  -H "Authorization: Bearer seu_token_jwt" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Crie um JSON com a data de hoje formatado corretamente",
    "tools": ["get_current_date", "format_json"],
    "maxToolIterations": 3
  }'
```

</RequestExample>

<ResponseExample>

```json Tool Simples
{
  "success": true,
  "data": {
    "content": "Hoje √© segunda-feira, 15 de janeiro de 2024, √†s 14:30 no hor√°rio de S√£o Paulo.",
    "toolResults": [
      {
        "toolName": "get_current_date",
        "arguments": {},
        "result": {
          "formatted": "15/01/2024 14:30:45, segunda-feira",
          "iso": "2024-01-15T17:30:45.123Z",
          "timestamp": 1705337445123
        },
        "timestamp": 1705337445000
      }
    ],
    "usage": {
      "promptTokens": 85,
      "completionTokens": 125,
      "totalTokens": 210
    },
    "finishReason": "stop"
  }
}
```

```json M√∫ltiplas Execu√ß√µes
{
  "success": true,
  "data": {
    "content": "Aqui est√° o JSON formatado com a data de hoje:\n```json\n{\n  \"data_atual\": {\n    \"dia\": 15,\n    \"mes\": 1,\n    \"ano\": 2024,\n    \"dia_semana\": \"segunda-feira\",\n    \"horario\": \"14:30:45\",\n    \"fuso\": \"America/Sao_Paulo\"\n  }\n}\n```",
    "toolResults": [
      {
        "toolName": "get_current_date",
        "arguments": {},
        "result": {
          "formatted": "15/01/2024 14:30:45, segunda-feira",
          "iso": "2024-01-15T17:30:45.123Z",
          "timestamp": 1705337445123
        },
        "timestamp": 1705337445000
      },
      {
        "toolName": "format_json",
        "arguments": {
          "json_string": "{\"data_atual\":{\"dia\":15,\"mes\":1,\"ano\":2024,\"dia_semana\":\"segunda-feira\",\"horario\":\"14:30:45\",\"fuso\":\"America/Sao_Paulo\"}}"
        },
        "result": {
          "valid": true,
          "formatted": "{\n  \"data_atual\": {\n    \"dia\": 15,\n    \"mes\": 1,\n    \"ano\": 2024,\n    \"dia_semana\": \"segunda-feira\",\n    \"horario\": \"14:30:45\",\n    \"fuso\": \"America/Sao_Paulo\"\n  }\n}"
        },
        "timestamp": 1705337446000
      }
    ],
    "usage": {
      "promptTokens": 180,
      "completionTokens": 285,
      "totalTokens": 465
    },
    "finishReason": "stop"
  }
}
```

```json Erro - Tool N√£o Encontrada
{
  "success": true,
  "data": {
    "content": "Desculpe, n√£o tenho acesso √† tool 'weather_api' para obter informa√ß√µes do clima.",
    "toolResults": [],
    "usage": {
      "promptTokens": 45,
      "completionTokens": 25,
      "totalTokens": 70
    },
    "finishReason": "stop"
  }
}
```

</ResponseExample>

## Tools Customizadas

Al√©m das tools internas, voc√™ pode registrar tools customizadas atrav√©s da API. Exemplo de estrutura:

```javascript
{
  "name": "calculate_price",
  "description": "Calcula o pre√ßo com desconto",
  "parameters": [
    {
      "name": "price",
      "type": "number",
      "description": "Pre√ßo original",
      "required": true
    },
    {
      "name": "discount",
      "type": "number",
      "description": "Percentual de desconto",
      "required": false
    }
  ],
  "handler": async (args) => {
    const finalPrice = args.price * (1 - (args.discount || 0) / 100);
    return { originalPrice: args.price, discount: args.discount, finalPrice };
  }
}
```

## Use Cases Avan√ßados

### üìÖ Assistente com Contexto Temporal
```json
{
  "prompt": "Quantos dias faltam para o final do m√™s?",
  "tools": ["get_current_date"],
  "systemPrompt": "Sempre considere o calend√°rio brasileiro e feriados"
}
```

### üîÑ Processamento de Dados
```json
{
  "prompt": "Pegue a data atual e crie um relat√≥rio em JSON",
  "tools": ["get_current_date", "format_json"],
  "maxToolIterations": 3
}
```

### ü§ñ Automa√ß√£o
```json
{
  "prompt": "Verifique se hoje √© dia √∫til e sugira tarefas apropriadas",
  "tools": ["get_current_date"],
  "temperature": 0.5
}
```

## Limita√ß√µes

1. **M√°ximo 5 itera√ß√µes** por padr√£o
2. **Tools devem estar registradas** previamente
3. **Cada itera√ß√£o consome tokens** adicionais
4. **Timeout de 60s** para toda a opera√ß√£o
5. **Resultados grandes** podem exceder limite de contexto