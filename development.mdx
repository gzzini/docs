---
title: 'desenvolvimento local'
description: 'configure o ambiente de desenvolvimento para trabalhar com nossa API'
---

<Info>
  **prÃ©-requisitos**:
  - Node.js versÃ£o 19 ou superior
  - Wrangler CLI instalado
  - Acesso ao Cloudflare Workers
  - Repository com `wrangler.toml` configurado
</Info>

este guia te ajuda a configurar o ambiente de desenvolvimento para trabalhar com nossa API do dashboard backend.

<Steps>
<Step title="configure o ambiente backend">

```bash
# clone o repositÃ³rio
git clone [REPO_URL]
cd dashboard-backend

# instale dependÃªncias
npm install
```
</Step>

<Step title="configure as variÃ¡veis de ambiente">

vocÃª precisarÃ¡ configurar as seguintes variÃ¡veis no `wrangler.toml`:

```toml
[vars]
JWT_SECRET = "seu_jwt_secret"
BEEHIIV_API_KEY = "sua_api_key"
GEMINI_API_KEY = "sua_gemini_key"
RESEND_API_KEY = "sua_resend_key"
# ... outras variÃ¡veis
```

<Warning>
  nunca commite secrets reais no repositÃ³rio. use `wrangler secret put` para secrets sensÃ­veis.
</Warning>
</Step>

<Step title="execute o servidor de desenvolvimento">

```bash
# inicia o servidor local conectado ao ambiente remoto
npm run dev
```

sua API estarÃ¡ disponÃ­vel em `http://localhost:8787`.

</Step>

<Step title="teste os endpoints">

vocÃª pode testar os endpoints usando curl ou Postman:

```bash
# teste um endpoint pÃºblico
curl http://localhost:8787/referrals/count

# teste um endpoint autenticado
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://localhost:8787/referrals
```

</Step>
</Steps>

## estrutura do projeto

nossa API Ã© organizada da seguinte forma:

```
dashboard-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/          # definiÃ§Ãµes de rotas
â”‚   â”œâ”€â”€ handlers/        # lÃ³gica de negÃ³cio
â”‚   â”œâ”€â”€ services/        # integraÃ§Ãµes externas
â”‚   â”œâ”€â”€ middleware/      # autenticaÃ§Ã£o e cache
â”‚   â”œâ”€â”€ schema/          # schemas do banco
â”‚   â””â”€â”€ types/           # tipos TypeScript
â”œâ”€â”€ drizzle/             # migraÃ§Ãµes do banco
â””â”€â”€ wrangler.toml        # configuraÃ§Ã£o do Workers
```

## bancos de dados

ossa arquitetura utiliza mÃºltiplos bancos D1 especializados:

<CardGroup cols={2}>
  <Card title="ğŸ“Š DB" icon="database">
    dados principais, mÃ©tricas e newsletters
  </Card>
  <Card title="ğŸ¯ STREAKS" icon="fire">
    gamificaÃ§Ã£o, leituras e engagement
  </Card>
  <Card title="ğŸ‘¥ CRM" icon="users">
    gestÃ£o de relacionamento com clientes
  </Card>
  <Card title="ğŸ“ FORMS" icon="file-text">
    formulÃ¡rios dinÃ¢micos e submissions
  </Card>
</CardGroup>

## migraÃ§Ãµes do banco

para aplicar migraÃ§Ãµes localmente:

```bash
# gerar nova migraÃ§Ã£o
npm run generate

# aplicar migraÃ§Ãµes localmente
npm run migrate
```

## deploy para produÃ§Ã£o

quando estiver pronto para fazer deploy:

```bash
# deploy com minificaÃ§Ã£o e source maps
npm run deploy
```

<Note>
  o deploy inclui automaticamente integraÃ§Ã£o com Sentry para monitoramento de erros.
</Note>

## ferramentas recomendadas

para melhor experiÃªncia de desenvolvimento:

- **VSCode** com extensÃµes TypeScript
- **Drizzle Kit** para gestÃ£o do banco
- **Postman** ou **Insomnia** para teste de APIs
- **Wrangler** para gestÃ£o do Cloudflare Workers

## soluÃ§Ã£o de problemas

<AccordionGroup>
  <Accordion title='erro: "wrangler not found"'>

    instale o wrangler CLI globalmente:
    ```bash
    npm install -g wrangler
    ```
    
    ou use via npx:
    ```bash
    npx wrangler dev --remote
    ```
  </Accordion>

  <Accordion title="erro de autenticaÃ§Ã£o com Cloudflare">
  
    faÃ§a login no Cloudflare:
    ```bash
    wrangler login
    ```
    
    verifique se o `account_id` estÃ¡ correto no `wrangler.toml`.
  </Accordion>
  
  <Accordion title="erro: banco de dados nÃ£o encontrado">
  
    verifique se os database IDs estÃ£o corretos no `wrangler.toml` e se os bancos existem no painel do Cloudflare.
  </Accordion>
  
  <Accordion title="endpoints retornando 500">
  
    verifique os logs do Sentry ou use `wrangler tail` para debug em tempo real:
    ```bash
    wrangler tail
    ```
  </Accordion>
</AccordionGroup>

<Tip>
  **dica**: use `console.log()` liberalmente durante desenvolvimento - os logs aparecerÃ£o no terminal com `npm run dev`.
</Tip>
